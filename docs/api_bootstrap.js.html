<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/bootstrap.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/bootstrap.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import axios from 'axios'
import {IncompatibleLedgerVersionError, NetworkUnavailableError, RunTimeError} from '../errors'
import * as semver from 'semver'
import {__version__} from '../init'


export class Bootstrap {
    /**
     * Gets list of servers from bootstrap network
     * @param  {active} active=true
     */
    static async list_servers(active = true) {
        //Gets list of (active) servers from bootstrap network
        const params = (active) ? {'active': 1} : {}

        let resp
        try {
            resp = await axios({
                method: 'get',
                url: 'https://bootstrap.fetch.ai/networks/',
                params: params
            })
        } catch (error) {
            throw new NetworkUnavailableError('Failed to get network status from bootstrap')
        }

        if (200 !== resp.status) {
            throw new NetworkUnavailableError('Failed to get network status from bootstrap')
        }

        return resp.data
    }

    static is_server_valid(server_list, network) {

        const available_servers = server_list.map(a => a.name)
        // Check requested server is on list
        if (!available_servers.includes(network)) {
            throw new NetworkUnavailableError(`Requested network not present on network: ${network}`)
        }

        let server_details

        for (let i = 0; i &lt; server_list.length; i++) {
            if (typeof server_list[i]['name'] !== 'undefined' &amp;&amp; server_list[i]['name'] === network) {
                server_details = server_list[i]
                break
            }
        }
        let invalid_flag = false

        if (server_details['versions'] !== '*') {
            let version_constraints = server_details['versions'].split(',')
            if (typeof server_details['prerelease'] !== 'undefined') invalid_flag = true
            if (typeof server_details['build'] !== 'undefined') invalid_flag = true
            if (typeof server_details['patch'] !== 'undefined' &amp;&amp; server_details['patch'] !== 0) invalid_flag = true
            if (!semver.satisfies(semver.coerce(__version__), version_constraints.join(' '))) invalid_flag = true
            if (invalid_flag) {
                throw new IncompatibleLedgerVersionError(`Requested network does not support required version\n
                                            Required version: ${semver.coerce(__version__)}\nNetwork supports: ${version_constraints.join(' ')}`
                )
            }
        }
        return true
    }

    static async get_ledger_address(network) {
        // Request server endpoints
        const params = {'network': network}

        let endpoints_response
        try {
            endpoints_response = await axios({
                method: 'get',
                url: 'https://bootstrap.fetch.ai/endpoints',
                params: params
            })
        } catch (error) {
            throw new NetworkUnavailableError('Failed to get network endpoint from bootstrap')
        }

        if (200 !== endpoints_response.status) {
            throw new NetworkUnavailableError('Failed to get network status from bootstrap, incorrect status code received')
        }

        if (typeof endpoints_response.data[0].address === 'undefined') {
            throw new RunTimeError('Ledger endpoint missing address')
        }

        return endpoints_response.data[0].address
    }

    /**
     *Splits a url into a protocol, host name and port
     * @param address
     */
    static split_address(address) {
        let protocol, port

        if (address.includes('://')) {
            [protocol, address] = address.split('://')
        } else {
            protocol = 'http'
        }
        if (address.includes(':')) {
            [address, port] = address.split(':')
        } else {
            port = (protocol == 'https') ? 443 : 8000
        }

        return [protocol, address, parseInt(port)]
    }


    /**
     * Queries bootstrap for the requested network and returns connection details
     * @param network
     */
    static async server_from_name(network) {
        //Get list of active servers
        const server_list = await Bootstrap.list_servers(true)
        // Check requested network exists and supports our ledger version
        Bootstrap.is_server_valid(server_list, network)
        // Get address of network ledger
        const ledger_address = await Bootstrap.get_ledger_address(network)
        // Check if address contains a port
        const [protocol, host, port] = Bootstrap.split_address(ledger_address)
        return [`${protocol}://${host}`, port]
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiEndpoint.html">ApiEndpoint</a></li><li><a href="BitVector.html">BitVector</a></li><li><a href="Entity.html">Entity</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_calculate_log2_num_bytes">_calculate_log2_num_bytes</a></li><li><a href="global.html#encode">encode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Nov 27 2019 13:25:42 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
