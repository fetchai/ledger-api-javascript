<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: bitvector.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: bitvector.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import assert from 'assert'
import reverse from 'buffer-reverse'

/**
 * This class for bitVector related operations
 *
 * @public
 * @class
 */
export class BitVector {
//TODO add rest of the methods from the python
    constructor(size = null) {
        if (size instanceof BitVector) {
            this._size = size._size
            this._byte_size = size._byte_size
            this._buffer = Buffer.from(size._buffer)
        } else {
            this._size = Number(size)
            this._byte_size = Math.floor((this._size + 7) / 8)
            this._buffer = Buffer.alloc(this._byte_size)
        }
    }

    __len__() {
        return this._size
    }

    __bytes__() {
        return reverse(this._buffer)
    }


    // Get bytes of this instance
    instance_bytes() {
        if (this._buffer) {
            // TODO: Improve logic
            return Buffer.from(
                this._buffer
                    .toString('hex')
                    .match(/.{2}/g)
                    .reverse()
                    .join(''),
                'hex'
            )
        }
        return ''
    }

    static from_bytes(data, bit_size) {
        // data in bytes
        // ensure the bit size matches the expectation
        let min_size = Math.max((data.length - 1) * 8, 1)
        let max_size = data.length * 8
        assert(min_size &lt;= bit_size &lt;= max_size)

        let bits = new BitVector()
        bits._size = bit_size
        bits._byte_size = Math.floor((bit_size + 7) / 8)
        // TODO: Improve logic
        bits._buffer = Buffer.from(
            data
                .toString('hex')
                .match(/.{2}/g)
                .reverse()
                .join(''),
            'hex'
        )
        return bits
    }

    static from_hex_string(hex_data) {
        let decoded_bytes = Buffer.from(hex_data, 'hex')
        return BitVector.from_bytes(decoded_bytes, decoded_bytes.length * 8)
    }

    byte_length() {
        return this._byte_size
    }

    get(bit) {
        let byte_index = Math.floor(bit / 8)
        let bit_index = bit &amp; 0x7
        return (this._buffer[byte_index] >> bit_index) &amp; 0x1
    }

    set(bit, value) {
        assert(0 &lt;= Number(value) &lt;= 1)
        let byte_index = Math.floor(bit / 8)
        let bit_index = bit &amp; 0x7
        this._buffer[byte_index] |= (value &amp; 0x1) &lt;&lt; bit_index
    }

    as_binary() {
        let output = ''
        let data = this.instance_bytes()
        for (let n of data) {
            // TODO: Improve logic
            output += Array.from(Array(8).keys())
                .reverse()
                .map(value => String(1 &amp; (Number(n) >> value)))
                .join('')
        }
        return output
    }

    as_hex() {
        let data = this.instance_bytes()
        return Buffer.from(data).toString('hex')
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiEndpoint.html">ApiEndpoint</a></li><li><a href="BitVector.html">BitVector</a></li><li><a href="Entity.html">Entity</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_calculate_log2_num_bytes">_calculate_log2_num_bytes</a></li><li><a href="global.html#encode">encode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Nov 27 2019 13:25:42 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
